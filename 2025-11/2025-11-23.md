## Spring

### OncePerRequestFilter
- jakarta.servlet.http.HttpFilterの実装クラス
- 1度だけ実行される
  - フィルター実行前に “実行済みフラグ” をリクエストに付けることで、1度だけ実行される
    ```java
    request.setAttribute(alreadyFilteredAttributeName, Boolean.TRUE);
    ```
  - View(JSP/Thymeleafなど)を返した際や、エラーハンドリング時に内部的に`forward`を呼び出しfilterが複数回実行される恐れがある。そのため、フラグを付けて同じリクエスト内では１度だけ実行するようにしている。
### CSRF（クロスサイトリクエストフォージェリ）
- 本人の意図しない不正な操作をウェブサイトに実行させる攻撃
- Spring Security使用時
  - 送信時に`Cookie のセッションID`と`フォームに含まれた CSRF トークン` → 両方一致しないと処理拒否
  - JWTの場合、攻撃者のサイトではヘッダーを勝手に追加できないため無効にしてもよい
